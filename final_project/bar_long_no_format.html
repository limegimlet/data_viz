<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v4.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.3.0.min.js"></script>

  <!-- Props to Kimerly Geswein for her font Shadows Into Light */ -->
  <link href='http://fonts.googleapis.com/css?family=Shadows+Into+Light' rel='stylesheet' type='text/css'>
  <style>

    .line {
      fill: none;
    }
    .box,.line {
      stroke: black;
      stroke-width: 2px;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .writing {
      font-family: 'Shadows Into Light', cursive;
      font-size: 20px;
      font-weight: 700;
    }
    .hatch_1 {
      fill: url(#down-hatch);
    }
    .hatch_2 {
      fill: url(#cross-hatch);
    }
    .hatch_3 {
      fill: url(#up-hatch);
    }
  </style>

  </style>

    <script type="text/javascript">
    function draw(data) {

      /*
        D3.js setup code
      */

        "use strict";
        var margin = 200,
            width = 800 - margin,
            height = 600 - margin;

        var title = d3.select("body")
            .append("h2")
              .text("Baseball players: HR vs Avg");

      /*
        Dimple.js Chart construction code
      */
          var svg = dimple.newSvg("#chartContainer", 590, 400);
          var myChart = new dimple.chart(svg, data);
          myChart.setMargins(110, 110, 20, 80);
          myChart.noFormats = true;

          var x = myChart.addCategoryAxis("x", ["attribute", "handedness"]);
          x.addOrderRule(["HR", "avg", "height", "weight"]);
          x.addGroupOrderRule(["L", "B", "R"]);

          var y = myChart.addMeasureAxis("y", "value");
          y.showGridlines = false;
          y.tickFormat = ',.0f';

          var s = myChart.addSeries(["handedness"], dimple.plot.bar);
          s.aggregate = dimple.aggregateMethod.avg;
          var colorAxis = myChart.addColorAxis("handedness");
          s.c = colorAxis;
          //s.barGap = 0.3;

          myChart.customClassList = {
             axisLine: 'line',
             barSeries: 'box',
             axisLabel: 'writing',
             axisTitle: 'writing',
             colorClasses: [
               'hatch_3', 
               'hatch_1',
               'hatch_2',
             ]
           };

           myChart.assignColor("L", 'hatch_1');
           myChart.assignColor("B", 'hatch_2');
           myChart.assignColor("R", 'hatch_3');


           // Override the standard tooltip behaviour
             s.addEventHandler("mouseover", function (e) {

                 var labelX = parseFloat(e.selectedShape.attr("x")) + parseFloat(e.selectedShape.attr("width") / 2),
                         labelY = parseFloat(e.selectedShape.attr("y")) - 70;

                 // Draw the text information in the top left corner
                 svg.append("text")
                         .attr("class", "tooltip writing")
                         .attr("x", labelX)
                         .attr("y", labelY)
                         .style("pointer-events", "none")
                         .style("text-anchor", "middle")
                         .text(e.seriesValue + " (" + d3.format(",.3f")(e.yValue) + ")");
                 svg.append("path")
                         .attr("class", "tooltip line")
                         .attr("transform", "translate(" + labelX + "," + labelY + ")")
                         .attr("d", "M 2 5 L 0 65 L -5 55 L 8 56 L 3 62")
                 });

                 // Clear the text on exit
                 s.addEventHandler("mouseleave", function (e) {
                     svg.selectAll(".tooltip").remove();
                 });

                /*s.addEventHandler("mouseover", function (e) {
                  var labelX = parseFloat(e.selectedShape.attr("x")) + parseFloat(e.selectedShape.attr("width") / 2),
                          labelY = parseFloat(e.selectedShape.attr("y")) - 70;

                  // Draw the text information in the top left corner
                  svg.append("text")
                          .attr("class", "tooltip writing")
                          .attr("x", labelX)
                          .attr("y", labelY)
                          .style("pointer-events", "none")
                          .style("text-anchor", "middle")
                          .text(e.xValue + " (" + d3.format(",.3f")(e.yValue) + ")");
                  svg.append("path")
                          .attr("class", "tooltip line")
                          .attr("transform", "translate(" + labelX + "," + labelY + ")")
                          .attr("d", "M 2 5 L 0 65 L -5 55 L 8 56 L 3 62")
                });

                // Clear the text on exit
                s.addEventHandler("mouseleave", function (e) {
                  svg.selectAll(".tooltip").remove();
              });*/

         myChart.draw();


        };

      </script>
  </head>
<body>
 <div id="chartContainer">
    <svg height="0" width="0">
      <defs>
        <pattern id="down-hatch" width="20" height="20" patternUnits="userSpaceOnUse">
          <line x1="0" x2="20" y1="0" y2="20" class="line"/>
          <line x1="-2" x2="2" y1="18" y2="22" class="line"/>
          <line x1="18" x2="22" y1="-2" y2="2" class="line"/>
        </pattern>
        <pattern id="up-hatch" width="20" height="20" patternUnits="userSpaceOnUse">
          <line x1="0" x2="20" y1="20" y2="0" class="line"/>
          <line x1="-2" x2="2" y1="2" y2="-2" class="line"/>
          <line x1="18" x2="22" y1="22" y2="18" class="line"/>
        </pattern>
        <pattern id="cross-hatch" width="14" height="20" patternUnits="userSpaceOnUse">
              <line x1="0" x2="20" y1="2" y2="2" class="line"/>
        </pattern>
      </defs>
    </svg>
  <script type="text/javascript">
  /*
    Use D3 (not dimple.js) to load the TSV file
    and pass the contents of it to the draw function
    */
    d3.csv("data/baseball_data_long.csv", draw);
  </script>
</div>
</body>
</html>
