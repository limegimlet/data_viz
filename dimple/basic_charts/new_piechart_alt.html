<html>
  <div id="chartContainer">
  <meta charset="utf-8">
    <link href='https://fonts.googleapis.com/css?family=Roboto:100,300,500' rel='stylesheet' type='text/css'>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>

    <style type="text/css">

    h1 {
      font-family: Roboto;
      opacity: 0.8;
    }

    .dimple-series-0 {
      opacity: 0.4;
    }

    </style>


    <script type = "text/javascript">
    // add chart title
      var title = "US Mobile Market Share";
      function addTitle(t) {
        d3.select("body")
          .insert("h1",":first-child")
            .text(t);
        };

        addTitle(title);

    var svg = dimple.newSvg("#chartContainer", 600,800);



    d3.tsv("new_mobile_data.tsv", function (data) {

      var myChart = new dimple.chart(svg, data);
      myChart.setBounds(65, 45,595, 515)
      var x = myChart.addCategoryAxis("x", "type");
      var y = myChart.addPctAxis("y", "mkt_share");
      var s = myChart.addSeries("company", dimple.plot.bar);
      x.title = null;
      y.title = null;
      y.ticks = 3;
      y.fontSize = 14;
      y.fontFamily = "Roboto";
      // Using the afterDraw callback means this code still works with animated
      // draws (e.g. myChart.draw(1000)) or storyboards (though an onTick callback should
      // also be used to clear the text from the previous frame)
      // Code taken from
      // http://dimplejs.org/advanced_examples_viewer.html?id=advanced_bar_labels
      s.afterDraw = function (shape, data) {
        // Get the shape as a d3 selection
        var s = d3.select(shape),
          rect = {
            x: parseFloat(s.attr("x")),
            y: parseFloat(s.attr("y")),
            width: parseFloat(s.attr("width")),
            height: parseFloat(s.attr("height"))
          }
        // Only label bars where the text can fit
        if (rect.height >= 8) {
          // Add a text label for the value
          svg.append("text")
            // Position in the centre of the shape (vertical position is
            // manually set due to cross-browser problems with baseline)
            .attr("x", rect.x + rect.width / 2)
            .attr("y", rect.y + rect.height / 2 + 3.5)
            // Centre align
            .style("text-anchor", "middle")
            .style("font-size", "14px")
            .style("font-family", "Roboto")
            // Make it a little transparent to tone down the black
            .style("opacity", 0.6)
            // print series label & value
            .text(data.aggField[0] + "\r" + d3.format(",.1f")(data.yValue) + "%");

        }
      };

      myChart.draw();
      //hide axis labels
      x.shapes.selectAll("text").attr("opacity", 0);
      y.shapes.selectAll("text").attr("opacity", 0.6);
      y.shapes.selectAll("g.dimple-axis").style("stroke", "red");
    });



    </script>
  </div>
</html>
